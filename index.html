<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HC Demographics Dashboard — ACS 5-Year</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- App styles -->
  <link rel="stylesheet" href="./styles.css">

  <!-- Chart.js FIRST (no defer, so window.Chart exists before app.js runs) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.3/chart.umd.min.js"></script>
</head>
<body>
  <!-- =========================
  HC Web Labs — Population & Demographics Dashboard (U.S. Census ACS 5-Year)
  ========================= -->
  <section id="hc-demog" data-scope="acs" aria-label="Population & Demographics Dashboard">
    <div class="wrap">
      <div class="head">
        <div class="title">
          <i class="fa-solid fa-person"></i>
          <div>
            <h1>U.S. Population & Demographics — ACS 5-Year</h1>
            <div class="badge">Year • States / Counties • Population • Med. Household Income • Med. Age</div>
          </div>
        </div>
        <div class="actions">
          <button class="btn ghost" id="exportCSV"><i class="fa-solid fa-file-csv"></i> Download CSV</button>
        </div>
      </div>

      <div class="controls" role="group" aria-label="Filters">
        <div class="ctl">
          <label for="year">ACS Year</label>
          <select id="year"></select>
        </div>
        <div class="ctl">
          <label for="geoLevel">Geography</label>
          <select id="geoLevel">
            <option value="state" selected>States</option>
            <option value="county">Counties in State</option>
          </select>
        </div>
        <div class="ctl" id="stateCtl" style="display:none">
          <label for="stateSel">State (for counties)</label>
          <select id="stateSel"></select>
        </div>
        <div class="ctl">
          <label for="metric">Metric</label>
          <select id="metric">
            <option value="B01003_001E" data-label="Total population" selected>Total population</option>
            <option value="B19013_001E" data-label="Median household income">Median household income (USD)</option>
            <option value="B01002_001E" data-label="Median age">Median age (years)</option>
          </select>
        </div>
        <div class="ctl">
          <label for="topN">Top N: <span id="topNVal">20</span></label>
          <input id="topN" type="range" min="5" max="50" step="5" value="20" />
        </div>
        <div class="ctl" style="align-self:end">
          <button class="btn primary" id="refresh"><i class="fa-solid fa-rotate"></i> Refresh</button>
        </div>
        <div class="ctl">
          <label for="apikey">Census API key (optional)</label>
          <input id="apikey" type="text" placeholder="Paste key (optional)" />
        </div>
      </div>

      <div class="kpis" id="kpis">
        <div class="kpi"><div class="label">Geographies</div><div class="value" id="kpiAreas">—</div><div class="delta" id="kpiAreasNote"></div></div>
        <div class="kpi"><div class="label">Population (sum)</div><div class="value" id="kpiPop">—</div><div class="delta" id="kpiPopNote"></div></div>
        <div class="kpi"><div class="label">Median HH income (avg)</div><div class="value" id="kpiInc">—</div><div class="delta" id="kpiIncNote"></div></div>
        <div class="kpi"><div class="label">Median age (avg)</div><div class="value" id="kpiAge">—</div><div class="delta" id="kpiAgeNote"></div></div>
      </div>

      <div class="grid">
        <div class="card">
          <div style="display:flex; align-items:center; gap:8px;">
            <h3 id="barTitle">Top by Metric</h3>
            <div class="toolbar">
              <button class="btn ghost" data-save="bar"><i class="fa-regular fa-image"></i> Save PNG</button>
            </div>
          </div>
          <canvas id="chartBars" role="img" aria-label="Top by selected metric"></canvas>
        </div>

        <div class="card">
          <div style="display:flex; align-items:center; gap:8px;">
            <h3 id="distTitle">Distribution</h3>
            <div class="toolbar">
              <button class="btn ghost" data-save="hist"><i class="fa-regular fa-image"></i> Save PNG</button>
            </div>
          </div>
          <canvas id="chartHist" role="img" aria-label="Distribution histogram"></canvas>
        </div>

        <div class="card table" style="grid-column:1 / -1;">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; padding:6px 8px 0;">
            <h3 style="margin:0" id="tableTitle">Table</h3>
            <div class="toolbar">
              <button class="btn ghost" id="copySnapshot"><i class="fa-regular fa-clipboard"></i> Copy Snapshot</button>
            </div>
          </div>
          <div>
            <table aria-label="ACS results">
              <thead>
                <tr>
                  <th>Geography</th>
                  <th>Population</th>
                  <th>Median HH Income</th>
                  <th>Median Age</th>
                  <th>State FIPS</th>
                  <th id="countyCol" style="display:none">County FIPS</th>
                </tr>
              </thead>
              <tbody id="rows">
                <tr><td colspan="6" style="text-align:center; color:var(--ink-3)">No data yet.</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="foot">
        <div class="status">
          <span class="pill" id="statusPill"><i class="fa-solid fa-circle-notch fa-spin"></i> Waiting</span>
          <span id="statusMsg">Choose settings and click Refresh.</span>
        </div>
        <div><small>Source: U.S. Census Bureau, American Community Survey (5-Year). Light use works without a key.</small></div>
      </div>
    </div>
  </section>

  <!-- App script (runs after Chart.js is available) -->
  <script src="./app.js" defer></script>
</body>
</html>
